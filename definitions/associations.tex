In CML,
an \emph{association} represents a relation between two \emph{concepts} (\ref{ch:concepts}),
where a reference to an \emph{instance} of each \emph{concept} is found in every tuple that is part of the relation.
When \emph{concepts} have an \emph{association} between themselves,
its \emph{instances} are linked in such way that
it is possible to access an \emph{instance} of one \emph{concept}
from an \emph{instance} of the other \emph{concept}.

The UML \cite{uml} metamodel has a metaclass named \emph{Association} that has \emph{Property} instances,
whose \emph{types} are the \emph{Class} instances that are part of the \emph{association}.
In UML, the name of each \emph{Property} instance in the \emph{Association} metaclass
is known as the \emph{role} of the corresponding \emph{Class} in the \emph{association}.

On the CML metamodel, on other hand,
the \emph{Association} metaclass is only needed
when it is necessary to define \emph{bidirectional associations},
whose \emph{links} are accessible from either \emph{association end}.
For \emph{unidirectional associations},
where only one \emph{association end}  is accessible,
only a \emph{property} is defined in the source \emph{concept},
making its \emph{type} the target \emph{concept}.

On the ER \cite{er} metamodel,
each \emph{association} is known as a \emph{relationship set},
and each tuple in this set is called a \emph{relationship}.
Unlike CML and UML,
the tuples in a \emph{relationship set} of an ER model
can be queried directly,
and no notion of \emph{property} is required as part of the \emph{entity type}
in order to access those \emph{relationships}.

As it is case for \emph{attributes} (\ref{ch:attributes}),
\emph{associations} in CML can also be derived from other \emph{associations}
(just as well as in UML);
they are called \emph{derived associations} (\ref{ch:derived-associations}).

\begin{examples}
Figure \ref{fig:ex:associations} presents some examples of \emph{associations} declared in CML.
The concept \textbf{Vehicle} contains the property \textbf{driver},
which may optionally refer to an instance of \textbf{Employee},
meaning that a \textbf{driver} may or may not be assigned to a single \textbf{Vehicle}.
The concept \textbf{Vehicle} also has the property \textbf{owner},
which always refers to an instance of \textbf{Organization},
meaning that an \textbf{owner} must always be assigned to each instance of \textbf{Vehicle}. 
Similarly,
the concept \textbf{Employee} has the property \textbf{employer},
which must always be assigned to instance of \textbf{Organization}.
Just below the declaration of \textbf{Organization},
we observe an association named \textbf{Employment},
which enumerates two \emph{properties}:
the first is \textbf{employer} from the concept \textbf{Employee};
the second is \textbf{employees} from the concept \textbf{Organization}.
What this \emph{association} implies is a correspondence between these two properties.
Every time a reference to an instance of \textbf{Organization} is assigned to
the slot \textbf{employer} of an instance of \textbf{Employee},
a reference to this same instance of \textbf{Employee} must be assigned to
the slot \textbf{employees} of the \textbf{Organization} instance.
However,
since the \emph{type} of \textbf{employees}
in the concept \textbf{Organization}
is a sequence of \textbf{Employee} instances,
the reference to the instance of \textbf{Employee} will actually be added to the sequence,
along with the other instances already found in the sequence.
Thus, the association \textbf{Employment} actually characterizes a \emph{bidirectional association}.
The association \textbf{VehicleOwnership} is another example of a \emph{bidirectional association};
in this case,
between \textbf{Vehicle}'s \textbf{owner} property and \textbf{Organization}'s \textbf{fleet} property.
It can be noticed, though, 
in this second \emph{bidirectional association},
that the \emph{types} of the \emph{properties} are declared along with their names;
such a \emph{type} declaration,
in the \emph{association} declaration,
is optional in CML,
but must match the original \emph{property} declaration under the \emph{concept} declaration,
if present.
The \textbf{driver} property in the concept \textbf{Vehicle} is a different case,
since this \emph{property} does not participate in any \emph{association} declaration
in figure \ref{fig:ex:associations}.
That's because there is no corresponding \emph{property} in the concept \textbf{Employee}
representing the other end of the \emph{association}.
As such, the property \textbf{driver} is representing the source end of a \emph{unidirectional association}.
The property \textbf{drivers} in the concept \textbf{Organization} will be explained
in the section \ref{sec:derived-associations}.
\end{examples}

\begin{figure}
\verbatimfont{\small}
\lstinputlisting[language=cml]{examples/associations.cml}
\caption{Association Examples}
\label{fig:ex:associations}
\end{figure}

\begin{concrete-syntax}
Figure \ref{fig:stx:association} specifies the syntax used
to declare an \emph{association}.
The \textbf{association} keyword is followed by a NAME.
A list of \emph{association ends} are declared under the \textbf{association} block.
For each declaration of an \emph{association end},
The \textbf{conceptName} and \textbf{propertyName} are optionally followed by a \emph{typeDeclaration}.
\end{concrete-syntax}

\begin{figure}
\verbatimfont{\small}
\lstinputlisting[language=antlr]{grammar/Associations.txt}
\caption{Association Declaration Syntax}
\label{fig:stx:association}
\end{figure}

\begin{abstract-syntax}
Figure \ref{fig:meta:association} presents the \emph{Association} metaclass
in an EMOF \cite{mof} class diagram,
and figure \ref{fig:ast:association} specifies
the \emph{association} transformation
from its concrete syntax to its abstract syntax.
For each \emph{association} parsed by the compiler,
an instance of the \emph{Association} class will be created,
and its properties will be assigned
according to parsed information:

\begin{itemize}

\item \emph{name}:
assigned with the value of the terminal node NAME.

\item \emph{members}:
an \emph{ordered set} referencing all \emph{associationEnd}
instances parsed in the \textbf{association} block.

\end{itemize}
\end{abstract-syntax}

\begin{figure}
\verbatimfont{\small}
\lstinputlisting[language=lsl]{ast/association.lsl}
\caption{Association AST Instantiation}
\label{fig:ast:association}
\end{figure}

\begin{constraints}

\end{constraints}